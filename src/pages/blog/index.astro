---
import { getCollection } from "astro:content";
import MainLayout from "@/layouts/MainLayout.astro";
import PostPreview from "@/components/PostPreview.astro";
import Text from "@/components/Text";
import { Icons } from "@/components/Icons";

const posts = await getCollection("blog");

const sortedPosts = posts
  .sort((a, b) => b.data.date.getTime() - a.data.date.getTime())
  .filter((post) => !post.data.draft);

const title = "viktor â€¢ blog";
---

<MainLayout title={title}>
  <Text level="h1">Blog</Text>
  {
    sortedPosts.length === 0 && (
      <div class="flex flex-col gap-y-8">
        <Text>My blog is currently under construction ðŸš§</Text>
        <Text>Curious about the progress?</Text>
      <a
        target="_blank"
        rel="noopener noreferrer"
        class="w-fit opacity-70 hover:opacity-100 gap-8 inline-flex rounded-md justify-between p-4 bg-foreground/5 transition-all hover:translate-x-1"
        href="https://github.com/JohnVicke/malmedal.dev"
      >
        <div class="flex gap-x-8">
          <Icons.github />
           View source on github
        </div>
        <Icons.arrowUpRight />
      </div>
    )
  }
  {sortedPosts && <div class="flex flex-col gap-4">
    {
      sortedPosts.map(({ data, slug }) => (
        <PostPreview
          post={{
            slug,
            ...data,
          }}
        />
      ))
    }
  </div>}
</MainLayout>
