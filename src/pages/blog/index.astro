---
import { getCollection } from "astro:content";
import MainLayout from "@/layouts/MainLayout.astro";
import PostPreview from "@/components/PostPreview.astro";
import Text from "@/components/Text";
import { getPageViews } from "@/db/get-pageviews";

const pageViews = await getPageViews();

const posts = await getCollection("blog", ({ data }) => {
  return !data.draft;
});

const sortedPosts = posts.sort(
  (a, b) => b.data.date.getTime() - a.data.date.getTime(),
);

const title = "viktor â€¢ blog";
---

<MainLayout title={title}>
  <Text level="h1">Blog</Text>
  <div class="flex flex-col gap-4">
    {
      sortedPosts?.map(({ data, slug }) => (
        <PostPreview
          post={{
            slug,
            ...data,
          }}
          views={pageViews.find((pageView) => pageView.id === slug)?.views ?? 0}
        />
      ))
    }
  </div>
</MainLayout>
